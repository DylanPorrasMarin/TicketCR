@model EventoModel

@{

    ViewBag.Title = "EditarEvento";
    Layout = "../Shared/_Dashboard.cshtml";


}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <link href="~/ticketCR/Img/shared/favicon.png" rel="icon">
    <title>Editar Evento</title>
    <link href="~/ticketCR/css/evento/editarEvento.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/chosen/1.8.7/chosen.min.css" integrity="sha512-yVvxUQV0QESBt1SyZbNJMAwyKvFTLMyXSyBHDO4BG5t7k/Lw34tyqlSDlKIrIENIzCl+RVUNjmCPG+V/GMesRw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css" />
    <script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>
</head>
<body>
    <div class="container">
        <div class="col-md-12 header">
            <h1>Editar evento</h1>
        </div>
        <div class="form-wrap">

            <form class="background-degradado" id="formulario-editar-evento">
                <div class="row">
                    <div class="col-md-4">
                        <div class="form-group">
                            <label id="nombre-label" for="name">Nombre</label>
                            <input type="text" name="name" id="nombre" placeholder="Nombre del evento" value="@Model.Nombre" class="form-control" required>
                        </div>
                    </div>

                    <div class="col-md-4">
                        <div class="form-group">
                            <label id="fecha-inicio-label" for="start-date">Fecha inicio</label>
                            <input type="text" name="start-date" id="fecha-inicio" value="@Model.FechaInicio" class="form-control"  placeholder="Fecha inicio">
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group">
                            <label id="fecha-final-label" for="end-date">Fecha Final</label>
                            <input type="text" name="end-date" id="fecha-final" value="@Model.FechaFinal" class="form-control" placeholder="Fecha Final">
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-4">
                        <div class="form-group">
                            <label id="slogan-label" for="email">Eslogan</label>
                            <input type="text" name="slogan" id="slogan" placeholder="Eslogan del evento" value="@Model.Eslogan" class="form-control" required>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group">
                            <label id="Modalidad-label" for="Modalidad">Modalidad</label>
                            <select name="modalidad" id="modalidad" class="form-control">
                                <option disabled value="">Tipo de modalidad</option>
                                <option value="1">Virtual</option>
                                <option value="2">Presencial</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group">
                            <label for="categoria">Categoría</label>
                            <select name="categoria" id="categoria" class="form-control" required>
                                <option selected disabled value="">Tipo categoría</option>
                                <option value="1">Deportivo</option>
                                <option value="2">Teatro</option>
                                <option value="3">Concierto</option>
                                <option value="4">Educativo</option>
                                <option value="5">Cine</option>
                                <option value="6">Festival</option>
                                <option value="7">Arte y Cultura</option>
                                <option value="8">Conferencia</option>
                                <option value="9">Gastronomía</option>
                                <option value="10">Moda</option>
                                <option value="11">Tecnología</option>
                                <option value="12">Empresarial</option>
                                <option value="13">Religioso</option>
                                <option value="14">Celebraciones y Aniversarios</option>
                                <option value="15">Medio ambiente y Sostenibilidad</option>
                                <option value="16">Entretenimiento</option>
                                <option value="17">Ferias y Exposiciones</option>
                                <option value="18">Otro</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="row">

                    <div id="contenedor-mapa-ubicacion" class="col-md-12">
                        <div class="form-group">
                            <label id="ubicacion-label" for="ubicacion">Ubicación</label>
                            <div class="width-40" style="width:100%; height:250px; margin-bottom:30px; border-radius:50px;">
                                <div style="border-radius:10px;" id="map"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label>Descripción</label>
                            <textarea id="descripcion" class="form-control" name="descripcion" value="" placeholder="Ingresa la descripción del evento...">@Model.Descripcion</textarea>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label>Restricciones</label>
                            <textarea id="restricciones" class="form-control" name="restricciones" placeholder="Ingresa las restricciones del evento...">@Model.Restricciones</textarea>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-12" style="width:100%">
                        <div class="container-link-evento">
                            <div class="form-group">
                                <label>Link evento virtual</label>
                                <input id="link" class="form-control" value="@Model.Link" name="link" placeholder="https://meet.google.com"></input>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- SECCION CREAR BOLETOS PARA EVENTO -->
                <div class="row">
                    <div class="col-md-12">
                        <div class="accordion accordion-flush" id="accordionFlushExample1">
                            <div style="border-radius:10px;" class="accordion-item">
                                <h2 style="border-radius:10px;" class="accordion-header" id="flush-headingOne">
                                    <button style="border-radius:10px; margin-bottom:20px;" class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseOne" aria-expanded="false" aria-controls="flush-collapseOne">
                                        Boletos creados
                                    </button>
                                </h2>
                                <div id="flush-collapseOne" class="accordion-collapse collapse" aria-labelledby="flush-headingOne" data-bs-parent="#accordionFlushExample1">
                                    <div class="form-wrap">

                                        <div class="background-degradado row">
                                            <div class="col-md-12">
                                                <div id="boletos-cargados"></div>
                                              </div>

                                            <div class="col-md-12">
                                                <div id="nuevos-boletos"></div>
                                            </div>
                                            <!--Se insertan nuevos campos de inputs para boletos dinámicamente-->
                                          
                                        </div>

                                  @*      <center style="padding-top:10px;" class="row">
                                            <div class="col-md-6">
                                                <button type="button" id="agregar-tipo-boleto-nuevo" class="sign-btn">Agregar otro tipo de boleto</button>
                                            </div>
                                            <div class="col-md-6">
                                                <button type="button" id="eliminar-tipo-boleto-nuevo" class="sign-btn eliminar-tipo-boleto-nuevo">Eliminar tipo de boleto</button>
                                            </div>
                                        </center>*@
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- TERMINA SECCION CREAR BOLETOS PARA EVENTO -->
                <!-- SECCION SELECCION DE PLANTILLA -->
             @*   <div id="contenedor-plantilla-grafica" class="row">
                    <div class="col-md-12">
                        <div class="accordion accordion-flush" id="accordionFlushExample2">
                            <div style="border-radius:10px;" class="accordion-item">
                                <h2 style="border-radius:10px;" class="accordion-header" id="flush-headingTwo">
                                    <button style="border-radius:10px; margin-bottom:20px;" class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwo" aria-expanded="false" aria-controls="flush-collapseTwo">
                                        Plantilla gráfica para evento
                                    </button>
                                </h2>
                                <div id="flush-collapseTwo" class="accordion-collapse collapse" aria-labelledby="flush-headingTwo" data-bs-parent="#accordionFlushExample2">
                                    <div class="form-wrap">

                                        <div class="row">
                                            <div class="col-md-12">
                                                <div class="form-group">
                                                    <label for="plantilla-selector">Selecciona una plantilla:</label>
                                                    <select id="plantilla-selector" class="form-select">
                                                        <option selected disabled value="0">Tipo plantilla</option>
                                                        <option value="1">Plantilla 1</option>
                                                        <option value="2">Plantilla 2</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="row">
                                            <div class="col-md-12">
                                                <div class="form-group" id="plantilla1-container">
                                                    <label for="plantilla1">Haz click sobre la imagen para configurar evento:</label>
                                                    <img class="plantilla" id="plantilla1-preview" src="~/ticketCR/Img/shared/plantilla1.png" alt="Imagen 1" style="width:100%; height:25vh;" data-bs-toggle="modal" data-bs-target="#modalEscenario1">
                                                </div>
                                            </div>

                                            <div class="col-md-12">
                                                <div class="form-group" id="plantilla2-container">
                                                    <label for="plantilla2">Haz click sobre la imagen para configurar evento:</label>
                                                    <img class="plantilla" id="plantilla2-preview" src="~/ticketCR/Img/shared/plantilla2.png" alt="Imagen 2" style="width:100%; height:25vh;" data-bs-toggle="modal" data-bs-target="#modalEscenario2">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>*@
                <!-- TERMINA SECCION SELECCION DE PLANTILLA -->
                <!-- COMIENZA SECCION DE SELECCION DE IMÁGENES PARA EL EVENTO -->
                <div class="row">
                    <div class="col-md-12">
                        <div class="accordion accordion-flush" id="accordionFlushExample3">
                            <div style="border-radius: 10px;" class="accordion-item">
                                <h2 style="border-radius: 10px;" class="accordion-header" id="flush-headingThree">
                                    <button style="border-radius: 10px; margin-bottom: 20px;" class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseThree" aria-expanded="false" aria-controls="flush-collapseThree">
                                        Seleccionar imágenes para evento
                                    </button>
                                </h2>
                                <div id="flush-collapseThree" class="accordion-collapse collapse" aria-labelledby="flush-headingThree" data-bs-parent="#accordionFlushExample3">
                                    <div class="form-wrap">
                                        <div class="row">
                                            <div class="col-md-12">
                                                <div class="grid-x grid-padding-x">
                                                    <div class="form-group">
                                                        <p>
                                                            <label for="upload_imgs" class="button hollow">Selecciona las nuevas imágenes para tu evento (3): PNG-JPG</label>
                                                            <!-- <input class="form-control" type="file" id="upload_imgs" name="upload_imgs[]" multiple accept=".png, .jpg" />  -->
                                                        </p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>


                                        <div class="row">
                                            <div class="col-md-4">
                                                <div class="grid-x grid-padding-x">
                                                    <div class="form-group">

                                                        <img src="@Model.Imagen1" class="img-preview-thumb" id="preview-imagen-evento-1" />
                                                        <button type="button" id="btn-foto1" class="sign-btn">Elegir imagen</button>

                                                        <!-- <div class="quote-imgs-thumbs quote-imgs-thumbs--hidden" id="img_preview" aria-live="polite"></div>-->
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-4">
                                                <div class="grid-x grid-padding-x">
                                                    <div class="form-group">

                                                        <img src="@Model.Imagen2" class="img-preview-thumb" id="preview-imagen-evento-2" />
                                                        <button type="button" id="btn-foto2" class="sign-btn">Elegir imagen</button>

                                                        <!-- <div class="quote-imgs-thumbs quote-imgs-thumbs--hidden" id="img_preview" aria-live="polite"></div>-->
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-4">
                                                <div class="grid-x grid-padding-x">
                                                    <div class="form-group">

                                                        <img src="@Model.Imagen3" class="img-preview-thumb" id="preview-imagen-evento-3" />
                                                        <button type="button" id="btn-foto3" class="sign-btn">Elegir imagen</button>

                                                        <!-- <div class="quote-imgs-thumbs quote-imgs-thumbs--hidden" id="img_preview" aria-live="polite"></div>-->
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- TERMINA SECCION DE SELECCION DE IMÁGENES PARA EL EVENTO --><!-- TERMINA SECCION TERCER ACCORDION -->
                <!-- BOTÓN PARA CREAR EVENTO -->
                <div style="padding-top:20px;" class="row">
                    <center class="col-md-6">
                        <button type="submit" id="btn-editar-evento" class="sign-btn text-center">Actualizar evento</button>
                    </center>
                    <center class="col-md-6">
                        @if (Model.Inactivo==false)
                        {
                            <button type="button" class="sign-btn2" onclick="desactivarEvento(@Model.IdEvento)">Desactivar</button>
                        }
                        else
                        {
                            <button type="button" class="sign-btn2" onclick="activarEvento(@Model.IdEvento)">Activar</button>
                        }
                    </center>
                </div>
                <!-- TERMINA BOTÓN PARA CREAR EVENTO -->
            </form>
        </div>
    </div>
    <!-- Inputs ocultos para almacenar latitudes y longitudes y otros atributos -->
    <input type="hidden" id="id-usuario" name="id-usuario" value="@Model.IdUsuario">
    <input type="hidden" id="id-rol" name="id-usuario" value="@Model.Usuario.Rol">
    <input type="hidden" id="id-membresia" name="membresia" value="@Model.Usuario.IdMembresia">
    <input type="hidden" id="id-cantidad-eventos" name="id-cantidad-eventos" value="@Model.Usuario.CantidadEventos">
    <input type="hidden" id="latitud-input" name="latitud" value="@Model.Latitud">
    <input type="hidden" id="longitud-input" name="longitud" value="@Model.Longitud">
    <input type="hidden" id="modalidad-cargada" value="@Model.Modalidad"/>
    <input type="hidden" id="categoria-cargada" value="@Model.idCategoria" />
    <input type="hidden" id="grafica-cargada" value="@Model.Grafica" />
    <input type="hidden" id="fechaInicio-cargada" value="@Model.FechaInicio" />
    <input type="hidden" id="fechaFinal-cargada" value="@Model.FechaFinal" />
    <input type="hidden" id="id-evento" value="@Model.IdEvento" />

    <!-- LLAMADO DE PLANTILLAS-->
    <partial name="_Escenario1" />
    <partial name="_Escenario2" />

    <script src="~/lib/jquery/dist/jquery.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="~/ticketCR/js/site.js"></script>
    <script src="~/ticketCR/js/alertas.js"></script>

    <script src="https://widget.cloudinary.com/v2.0/global/all.js" type="text/javascript"></script>
    <script src="~/ticketCR/js/evento/editarEvento.js"></script>

    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyARvTpwIJm0YHxlqtsT3eLcUNAuQbmLCU0&callback=initMap" defer></script>
    <!--DATA PICKER CALENDAR-->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/momentjs/latest/moment.min.js" defer></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js" defer></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>

    <!--MOMENT PARA DAR FORMATOS A FECHAS-->
    <script src="https://cdn.jsdelivr.net/npm/moment/moment.min.js"></script>

    <script>

        var cantidadBoletosCreadosCargados=parseInt('@Model.CantidadBoletosCreados');

        console.log('CANTIDAD BOLETOS CREADOS', cantidadBoletosCreadosCargados)


        $(document).ready(function () {
            // Lista de boletos obtenida del backend
            var boletos = @Html.Raw(Json.Serialize(Model.Boletos));
            // Objeto auxiliar para almacenar la cantidad total por tipo de boleto
            var cantidadPorTipo = {
                '1': { cantidad: 0, costo: 0 }, // Particular
                '2': { cantidad: 0, costo: 0 }, // Estudiante
                '3': { cantidad: 0, costo: 0 }, // Adulto mayor
                '4': { cantidad: 0, costo: 0 },  // Regalía
                '5': { cantidad: 0, costo: 0 }  // Virtual
            };


            // Calcular la cantidad total y el costo por tipo de boleto

            boletos.forEach(function (boleto) {
                var tipo = boleto.tipoBoleto;
                // Sumar 1 a la cantidad total del tipo de boleto
                cantidadPorTipo[tipo].cantidad++;
                // Sumar el costo del boleto al costo total del tipo de boleto
                cantidadPorTipo[tipo].costo = boleto.costo;
            });

            // Imprimir los resultados en la consola para verificar
            for (var tipo in cantidadPorTipo) {
                if (cantidadPorTipo.hasOwnProperty(tipo)) {
                    console.log('Tipo de boleto:', tipo, 'Cantidad:', cantidadPorTipo[tipo].cantidad, 'Costo:', cantidadPorTipo[tipo].costo);
                }
            }


            // Obtener el contenedor donde se agregarán los nuevos campos de boletos
            var nuevosBoletosContainer = $("#boletos-cargados");

            // Función para generar un nuevo campo de boleto
            function generarCampoBoleto(tipo, cantidad, costo) {
                // Crear un nuevo div para contener el campo de boleto
                var nuevoCampoBoleto = $("<div>").addClass("row");

                // Crear el campo de tipo de boleto (select)
                var campoTipoBoleto = $("<select>").attr("name", "tipoBoleto-" + tipo).addClass("tipo-Boleto form-control").prop("required", true);

                campoTipoBoleto.append($('<option>', {
                    value: tipo,
                    text: tipo === "1" ? "Particular" : tipo === "2" ? "Estudiante" : tipo === "3" ? "Adulto mayor" : tipo === "4" ? "Regalia" : tipo === '5' ? "Virtual" : ""
                }));

            

                // Agregar etiqueta <label> para el campo de tipo de boleto
                var labelTipoBoleto = $("<label>").attr("for", "tipoBoleto-" + tipo).text("Tipo de boleto");
                nuevoCampoBoleto.append($("<div>").addClass("col-md-4").append(labelTipoBoleto).append(campoTipoBoleto));

                // Crear el campo de cantidad de boletos (input type="number")
                var campoCantidadBoletos = $("<input>").attr({ disabled: "true", type: "number", name: "cantidadBoletos" + tipo }).addClass("cantidad-boleto form-control").val(cantidad);

                // Agregar etiqueta <label> para el campo de cantidad de boletos
                var labelCantidadBoletos = $("<label>").attr("for", "cantidadBoletos" + tipo).text("Cantidad");
                nuevoCampoBoleto.append($("<div>").addClass("col-md-4").append(labelCantidadBoletos).append(campoCantidadBoletos));

                // Crear el campo de costo de boleto (input type="number")
                var campoCostoBoleto = $("<input>").attr({ disabled: "true", type: "number", name: "costoBoleto" + tipo }).addClass("form-control").val(costo);

                // Agregar etiqueta <label> para el campo de costo de boleto
                var labelCostoBoleto = $("<label>").attr("for", "costoBoleto" + tipo).text("Costo($)");
                nuevoCampoBoleto.append($("<div>").addClass("col-md-4").append(labelCostoBoleto).append(campoCostoBoleto));

                // Agregar el nuevo campo de boleto al contenedor
                nuevosBoletosContainer.append(nuevoCampoBoleto);
            }

            // Generar y cargar los campos de boletos por tipo
            for (var tipo in cantidadPorTipo) {
                if (cantidadPorTipo.hasOwnProperty(tipo)) {
                    generarCampoBoleto(tipo, cantidadPorTipo[tipo].cantidad, cantidadPorTipo[tipo].costo);
                }
            }


            //DAR FORMATO A FECHAS
            var fecha = @Html.Raw(Json.Serialize(Model.FechaInicio));
            var fechaFinal = @Html.Raw(Json.Serialize(Model.FechaFinal));
            console.log('Fecha original:', fecha);

            // Convertir la cadena de fecha en un objeto Date
            var fechaObj = new Date(fecha);

            // Obtener los componentes de fecha y hora
            var anio = fechaObj.getFullYear();
            var mes = String(fechaObj.getMonth() + 1).padStart(2, '0');
            var dia = String(fechaObj.getDate()).padStart(2, '0');
            var hora = String(fechaObj.getHours()).padStart(2, '0');
            var minutos = String(fechaObj.getMinutes()).padStart(2, '0');
            var segundos = String(fechaObj.getSeconds()).padStart(2, '0');

            // Formatear la fecha en el formato deseado "2023-08-06 16:00:00"
            var fechaFormateada = anio + '-' + mes + '-' + dia + ' ' + hora + ':' + minutos + ':' + segundos;
            console.log('Fecha formateada:', fechaFormateada);
            $("#fecha-inicio").val(fechaFormateada);


            // Convertir la cadena de fecha en un objeto Date
            var fechaFinalObj = new Date(fechaFinal);

            // Obtener los componentes de fecha y hora
            var anioFinal = fechaFinalObj.getFullYear();
            var mesFinal = String(fechaFinalObj.getMonth() + 1).padStart(2, '0');
            var diaFinal = String(fechaFinalObj.getDate()).padStart(2, '0');
            var horaFinal = String(fechaFinalObj.getHours()).padStart(2, '0');
            var minutosFinal = String(fechaFinalObj.getMinutes()).padStart(2, '0');
            var segundosFinal = String(fechaFinalObj.getSeconds()).padStart(2, '0');

            // Formatear la fecha final en el formato deseado "2023-08-06 16:00:00"
            var fechaFinalFormateada = anioFinal + '-' + mesFinal + '-' + diaFinal + ' ' + horaFinal + ':' + minutosFinal + ':' + segundosFinal;

            // Asignar la fecha final formateada al input
            $("#fecha-final").val(fechaFinalFormateada);



        });
    </script>




</body>
</html>
